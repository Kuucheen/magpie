<div class="content-container">
  <section class="theme-section">
    <h3 class="mt-0">Interface Color</h3>
    <p class="theme-description">Choose the accent color you prefer.</p>
    <div class="theme-options">
      @for (theme of themes; track theme) {
        <button type="button"
                class="theme-option"
                [class.theme-option--active]="currentTheme() === theme"
                (click)="setTheme(theme)"
                [attr.aria-pressed]="currentTheme() === theme">
          <span class="theme-swatch" [style.background]="colorFor(theme)"></span>
          <span class="theme-label">{{ labelFor(theme) }}</span>
        </button>
      }
    </div>
  </section>

  <!-- Password card -->
  <section class="password-card">
    <div class="password-card__head">
      <h3 class="mt-0">Change Password</h3>
      <p class="muted">Use at least 8 characters.</p>
    </div>

    <form [formGroup]="passwordForm" (ngSubmit)="onSubmit()" class="form-grid">

      <!-- Current password -->
      <div class="field">
        <label for="oldPassword">Current password</label>
        <p-password inputId="newPassword"
                    formControlName="newPassword"
                    [feedback]="false"
                    [toggleMask]="true"
                    promptLabel="Enter a password"
                    styleClass="text-input accent-focus">
        </p-password>


        @if (passwordForm.get('oldPassword')?.hasError('required') && passwordForm.get('oldPassword')?.touched) {
          <small class="field-error">Current password is required</small>
        }
      </div>

      <!-- New password -->
      <div class="field">
        <label for="newPassword">New password</label>
        <p-password inputId="newPassword"
                    formControlName="newPassword"
                    [feedback]="true"
                    [toggleMask]="true"
                    promptLabel="Enter a password"
                    styleClass="text-input accent-focus">
        </p-password>

        @if (passwordForm.get('newPassword')?.hasError('required') && passwordForm.get('newPassword')?.touched) {
          <small class="field-error">New password is required</small>
        }
        @if (passwordForm.get('newPassword')?.hasError('minlength') && passwordForm.get('newPassword')?.touched) {
          <small class="field-error">Minimum length is 8 characters</small>
        }
      </div>

      <!-- Repeat new password -->
      <div class="field">
        <label for="newPasswordCheck">Repeat new password</label>
        <p-password inputId="newPasswordCheck"
                    formControlName="newPasswordCheck"
                    [feedback]="false"
                    [toggleMask]="true"
                    styleClass="text-input accent-focus">
        </p-password>

        @if (passwordForm.hasError('passwordsMismatch') && passwordForm.get('newPasswordCheck')?.touched) {
          <small class="field-error">Passwords do not match</small>
        }
      </div>

      <!-- Submit -->
      <div class="actions">
        <p-button type="submit"
                  label="Save password"
                  [disabled]="passwordForm.invalid"
                  styleClass="btn-accent">
        </p-button>
      </div>
    </form>
  </section>

  <section class="danger-card">
    <div class="danger-card__head">
      <h3 class="mt-0">Delete Account</h3>
      <p class="muted">This action permanently deletes your account and data.</p>
    </div>
    <p class="danger-note">This action cannot be undone.</p>

    <div class="actions">
      <p-button type="button"
                label="Delete account"
                (onClick)="openDeleteDialog()"
                styleClass="btn-danger p-button-danger">
      </p-button>
    </div>
  </section>

  <p-dialog
    [visible]="deleteDialogVisible"
    (visibleChange)="deleteDialogVisible = $event"
    [modal]="true"
    [draggable]="false"
    [resizable]="false"
    [dismissableMask]="true"
    [breakpoints]="{ '960px': '90vw', '640px': '95vw' }"
    [style]="{ width: '32rem' }"
    [appendTo]="'body'"
    styleClass="danger-dialog"
    (onHide)="onDeleteDialogHide()"
  >
    <ng-template pTemplate="header">
      <div class="danger-dialog__title">Confirm account deletion</div>
    </ng-template>

    <form [formGroup]="deleteAccountForm" (ngSubmit)="onDeleteAccount()" class="form-grid danger-dialog__body">
      <div class="field">
        <label for="deletePassword">Enter your password</label>
        <p-password inputId="deletePassword"
                    formControlName="password"
                    [feedback]="false"
                    [toggleMask]="true"
                    styleClass="text-input danger-focus">
        </p-password>

        @if (deleteAccountForm.get('password')?.hasError('required') && deleteAccountForm.get('password')?.touched) {
          <small class="field-error">Password is required</small>
        }
      </div>

      <p class="danger-note">This action permanently deletes your account and data.</p>

      <div class="dialog-actions">
        <p-button type="button"
                  label="Cancel"
                  styleClass="p-button-text"
                  (onClick)="closeDeleteDialog()">
        </p-button>
        <p-button type="submit"
                  label="Delete account"
                  [disabled]="deleteAccountForm.invalid || deletingAccount"
                  styleClass="btn-danger p-button-danger">
        </p-button>
      </div>
    </form>
  </p-dialog>

</div>
