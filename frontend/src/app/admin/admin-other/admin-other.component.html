<div class="admin-other-page text-gray-200">
  <form
    [formGroup]="form"
    (ngSubmit)="onSubmit()"
    class="settings-panel bg-neutral-900 border border-neutral-800 rounded-2xl p-6 shadow-lg">
    <header class="panel-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
      <div>
        <h2 class="text-xl font-semibold text-white mb-1">GeoLite Configuration</h2>
        <p class="text-sm text-gray-400 max-w-3xl">
          Manage the MaxMind credentials and cadence used to keep GeoIP databases fresh for proxy enrichment.
        </p>
      </div>
    </header>

    <div class="panel-body mt-6">
      <div class="tab-stack">
        <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
          <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
            <div>
              <h3 class="section-title">License Key</h3>
              <p class="section-hint">Provide the MaxMind GeoLite2 license key used to download the database bundle.</p>
            </div>
          </div>

          <div class="field-group mt-4">
            <label class="field-label" for="geolite-api-key">GeoLite API Key</label>
            <input
              id="geolite-api-key"
              type="text"
              pInputText
              formControlName="api_key"
              autocomplete="off"
              placeholder="Enter MaxMind license key"
              class="p-inputtext-sm w-full"/>
          </div>
        </section>

        <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
          <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
            <div>
              <h3 class="section-title">Automatic Updates</h3>
              <p class="section-hint">Enable recurring refreshes and set the interval that controls GeoLite downloads.</p>
            </div>
          </div>

          <div class="toggle-card">
            <div class="toggle-leading">
              <p-checkbox
                inputId="geolite-auto-update"
                formControlName="auto_update"
                [binary]="true">
              </p-checkbox>
            </div>
            <label for="geolite-auto-update" class="toggle-content">
              <span class="toggle-title">Enable automatic updates</span>
              <span class="toggle-hint">When enabled, the service refreshes GeoLite data based on the interval below.</span>
            </label>
          </div>

          <div
            class="timer-grid mt-4"
            formGroupName="update_timer"
            [class.disabled]="!form.get('auto_update')?.value">
            <div class="timer-field">
              <label class="field-label" for="geolite-days">Days</label>
              <p-select
                inputId="geolite-days"
                formControlName="days"
                [options]="daysList"
                optionLabel="label"
                optionValue="value"
                placeholder="Select days"
                class="w-full">
              </p-select>
            </div>
            <div class="timer-field">
              <label class="field-label" for="geolite-hours">Hours</label>
              <p-select
                inputId="geolite-hours"
                formControlName="hours"
                [options]="hoursList"
                optionLabel="label"
                optionValue="value"
                placeholder="Select hours"
                class="w-full">
              </p-select>
            </div>
            <div class="timer-field">
              <label class="field-label" for="geolite-minutes">Minutes</label>
              <p-select
                inputId="geolite-minutes"
                formControlName="minutes"
                [options]="minutesList"
                optionLabel="label"
                optionValue="value"
                placeholder="Select minutes"
                class="w-full">
              </p-select>
            </div>
            <div class="timer-field">
              <label class="field-label" for="geolite-seconds">Seconds</label>
              <p-select
                inputId="geolite-seconds"
                formControlName="seconds"
                [options]="secondsList"
                optionLabel="label"
                optionValue="value"
                placeholder="Select seconds"
                class="w-full">
              </p-select>
            </div>
          </div>

          <div class="meta-info mt-5">
            <span class="meta-label">Last successful update</span>
            <span class="meta-value">{{ lastUpdatedLabel }}</span>
          </div>
        </section>
      </div>
    </div>

    <footer class="panel-footer mt-6 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
      <p class="text-xs text-gray-500 max-w-xl">
        Saving immediately refreshes GeoLite databases when a license key is present and auto updates are enabled.
      </p>
      <p-button
        type="submit"
        label="Save Settings"
        icon="pi pi-save"
        [disabled]="form.invalid || form.pristine"
        styleClass="save-button">
      </p-button>
    </footer>
  </form>
</div>
