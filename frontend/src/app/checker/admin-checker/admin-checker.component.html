<div class="admin-checker-page text-gray-200">
  <form [formGroup]="settingsForm" class="settings-panel bg-neutral-900 border border-neutral-800 rounded-2xl p-6 shadow-lg">
    <header class="panel-header flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <h2 class="text-xl font-semibold text-white mb-1">Admin Checker Configuration</h2>
        <p class="text-sm text-gray-400 max-w-3xl">
          Fine-tune how the admin checker validates proxies, refreshes judges, and keeps your blacklist in sync. These
          settings shape the cadence, performance, and safeguards used during automated checks.
        </p>
      </div>
    </header>

    <div class="panel-body mt-6">
      <p-tabs value="0">
        <p-tablist class="tablist">
          <p-tab value="0">Common</p-tab>
          <p-tab value="1">Judges</p-tab>
          <p-tab value="2">IP</p-tab>
          <p-tab value="3">Blacklist</p-tab>
        </p-tablist>

        <p-tabpanels>
          <!-- Common Tab -->
          <p-tabpanel value="0">
            <div class="tab-stack">
              <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
                <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
                  <div>
                    <h3 class="section-title">Protocols</h3>
                    <p class="section-hint">Select the proxy types that should be included in each automated pass.</p>
                  </div>
                </div>
                <div class="protocol-grid" formGroupName="protocols">
                  <div class="protocol-option">
                    <app-checkbox label="HTTP" formControlName="http"></app-checkbox>
                  </div>
                  <div class="protocol-option">
                    <app-checkbox label="HTTPS" formControlName="https"></app-checkbox>
                  </div>
                  <div class="protocol-option">
                    <app-checkbox label="SOCKS4" formControlName="socks4"></app-checkbox>
                  </div>
                  <div class="protocol-option">
                    <app-checkbox label="SOCKS5" formControlName="socks5"></app-checkbox>
                  </div>
                </div>
              </section>

              <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
                <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
                  <div>
                    <h3 class="section-title">Checker Cadence</h3>
                    <p class="section-hint">Define how often the system should re-run validation across all proxies.</p>
                  </div>
                </div>
                <div class="timer-grid" formGroupName="checker_timer">
                  <div class="timer-field">
                    <label class="field-label">Days</label>
                    <p-select
                      [options]="daysList"
                      formControlName="days"
                      placeholder="Select Days"
                      optionLabel="label"
                      optionValue="value"
                      class="w-full">
                    </p-select>
                  </div>
                  <div class="timer-field">
                    <label class="field-label">Hours</label>
                    <p-select
                      [options]="hoursList"
                      formControlName="hours"
                      placeholder="Select Hours"
                      optionLabel="label"
                      optionValue="value"
                      class="w-full">
                    </p-select>
                  </div>
                  <div class="timer-field">
                    <label class="field-label">Minutes</label>
                    <p-select
                      [options]="minutesList"
                      formControlName="minutes"
                      placeholder="Select Minutes"
                      optionLabel="label"
                      optionValue="value"
                      class="w-full">
                    </p-select>
                  </div>
                  <div class="timer-field">
                    <label class="field-label">Seconds</label>
                    <p-select
                      [options]="secondsList"
                      formControlName="seconds"
                      placeholder="Select Seconds"
                      optionLabel="label"
                      optionValue="value"
                      class="w-full">
                    </p-select>
                  </div>
                </div>
              </section>

              <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
                <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
                  <div>
                    <h3 class="section-title">Checker Performance</h3>
                    <p class="section-hint">Balance throughput and reliability by tuning concurrency and retry limits.</p>
                  </div>
                </div>
                <div class="field-grid">
                  <div class="field-group">
                    <label class="field-label" for="threads">
                      Threads
                      <app-tooltip [text]="'Determines how many proxies are checked concurrently.'"></app-tooltip>
                    </label>
                    <input id="threads" formControlName="threads" type="number" pInputText class="p-inputtext-sm w-full"/>
                  </div>
                  <div class="field-group">
                    <label class="field-label" for="retries">Retries</label>
                    <input id="retries" formControlName="retries" type="number" pInputText class="p-inputtext-sm w-full"/>
                  </div>
                  <div class="field-group">
                    <label class="field-label" for="timeout">Timeout (ms)</label>
                    <input id="timeout" formControlName="timeout" type="number" pInputText class="p-inputtext-sm w-full"/>
                  </div>
                </div>
              </section>

              <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
                <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
                  <div>
                    <h3 class="section-title">Automation Enhancements</h3>
                    <p class="section-hint">Enable helper features that keep the checker responsive under varying load.</p>
                  </div>
                </div>
                <div class="toggle-grid">
                  <div class="toggle-option">
                    <app-checkbox label="Dynamic Threads" formControlName="dynamic_threads"></app-checkbox>
                  </div>
                  <div class="toggle-option">
                    <app-checkbox label="Use HTTPS for SOCKS" formControlName="use_https_for_socks"></app-checkbox>
                  </div>
                </div>
              </section>
            </div>
          </p-tabpanel>

          <!-- Judges Tab -->
          <p-tabpanel value="1">
            <div class="tab-stack">
              <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
                <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
                  <div>
                    <h3 class="section-title">Judge Performance</h3>
                    <p class="section-hint">Adjust throughput and tolerance for judge validation requests.</p>
                  </div>
                </div>
                <div class="field-grid">
                  <div class="field-group">
                    <label class="field-label" for="judges_threads">Judge Threads</label>
                    <input id="judges_threads" formControlName="judges_threads" type="number" pInputText class="p-inputtext-sm w-full"/>
                  </div>
                  <div class="field-group">
                    <label class="field-label" for="judges_timeout">Judge Timeout (ms)</label>
                    <input id="judges_timeout" formControlName="judges_timeout" type="number" pInputText class="p-inputtext-sm w-full"/>
                  </div>
                </div>
              </section>

              <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
                <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
                  <div>
                    <h3 class="section-title">Judge Refresh Cadence</h3>
                    <p class="section-hint">Decide how frequently the platform should refresh judge endpoints.</p>
                  </div>
                </div>
                <div class="timer-grid" formGroupName="judge_timer">
                  <div class="timer-field">
                    <label class="field-label">Days</label>
                    <p-select
                      [options]="daysList"
                      formControlName="days"
                      placeholder="Select Days"
                      optionLabel="label"
                      optionValue="value"
                      class="w-full">
                    </p-select>
                  </div>
                  <div class="timer-field">
                    <label class="field-label">Hours</label>
                    <p-select
                      [options]="hoursList"
                      formControlName="hours"
                      placeholder="Select Hours"
                      optionLabel="label"
                      optionValue="value"
                      class="w-full">
                    </p-select>
                  </div>
                  <div class="timer-field">
                    <label class="field-label">Minutes</label>
                    <p-select
                      [options]="minutesList"
                      formControlName="minutes"
                      placeholder="Select Minutes"
                      optionLabel="label"
                      optionValue="value"
                      class="w-full">
                    </p-select>
                  </div>
                  <div class="timer-field">
                    <label class="field-label">Seconds</label>
                    <p-select
                      [options]="secondsList"
                      formControlName="seconds"
                      placeholder="Select Seconds"
                      optionLabel="label"
                      optionValue="value"
                      class="w-full">
                    </p-select>
                  </div>
                </div>
              </section>

              <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
                <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
                  <div>
                    <h3 class="section-title">Default Judges</h3>
                    <p class="section-hint">By default, these judges are added to every new account.</p>
                  </div>
                </div>
                <div formArrayName="judges" class="judge-list flex flex-col gap-4">
                  @for (judge of judges.controls; track judge; let i = $index) {
                    <div [formGroupName]="i" class="judge-row">
                      <div class="field-group">
                        <label class="field-label" for="judge-url-{{i}}">URL</label>
                        <input id="judge-url-{{i}}" formControlName="url" type="text" pInputText class="p-inputtext-sm w-full"/>
                      </div>
                      <div class="field-group">
                        <label class="field-label" for="judge-regex-{{i}}">
                          Regex
                          <app-tooltip [text]="'If the regex is set to default...etc'"></app-tooltip>
                        </label>
                        <input id="judge-regex-{{i}}" formControlName="regex" type="text" pInputText class="p-inputtext-sm w-full"/>
                      </div>
                      @if (judges.length > 1) {
                        <button type="button" class="icon-button remove" (click)="removeJudge(i)">
                          <i class="pi pi-trash"></i>
                        </button>
                      }
                    </div>
                  }
                </div>
                <div class="judge-actions mt-3">
                  <button type="button" class="chip-button" (click)="addJudge()">
                    <i class="pi pi-plus"></i>
                    <span>Add Judge</span>
                  </button>
                </div>
              </section>
            </div>
          </p-tabpanel>

          <!-- IP Tab Placeholder -->
          <p-tabpanel value="2">
            <div class="tab-stack">
              <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
                <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
                  <div>
                    <h3 class="section-title text-white">IP Lookup</h3>
                    <p class="section-hint text-gray-400">Configure the lookup endpoint used to determine the checker host's public IP.
                      <app-tooltip [text]="'This website is requested on startup so the checker can compare proxy responses against the server\'s actual IP.'"></app-tooltip>
                    </p>
                  </div>
                </div>

                <div class="field-group mt-4">
                  <label class="field-label" for="iplookup">
                    Lookup URL
                  </label>
                  <input id="iplookup" formControlName="iplookup" type="url" pInputText class="p-inputtext-sm w-full" placeholder="https://ident.me"/>
                </div>
              </section>
            </div>
          </p-tabpanel>

          <!-- Blacklist Tab Placeholder -->
          <p-tabpanel value="3">
            <div class="tab-stack">
              <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
                <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
                  <div>
                    <h3 class="section-title text-white">Blacklist Controls</h3>
                    <p class="section-hint text-gray-400">Manage the remote blacklist sources that are fetched to prune bad proxies automatically.</p>
                  </div>
                </div>

                <div formArrayName="blacklisted" class="blacklist-list flex flex-col gap-4 mt-4">
                  @if (!blacklisted.length) {
                    <p class="text-sm text-gray-500">No blacklist sources configured yet.</p>
                  }

                  @for (control of blacklisted.controls; track control; let i = $index) {
                    <div class="blacklist-row flex items-start gap-3">
                      <div class="field-group flex-1">
                        <label class="field-label" for="blacklist-url-{{i}}">Source URL</label>
                        <input
                          id="blacklist-url-{{i}}"
                          type="url"
                          class="p-inputtext-sm w-full"
                          pInputText
                          [formControlName]="i"
                          placeholder="https://example.com/blacklist.txt"/>
                      </div>

                      <button type="button" class="icon-button remove mt-6" (click)="removeBlacklistedUrl(i)">
                        <i class="pi pi-trash"></i>
                      </button>
                    </div>
                  }
                </div>

                <div class="blacklist-actions mt-3">
                  <button type="button" class="chip-button" (click)="addBlacklistedUrl()">
                    <i class="pi pi-plus"></i>
                    <span>Add Source</span>
                  </button>
                </div>
              </section>
            </div>
          </p-tabpanel>
        </p-tabpanels>
      </p-tabs>
    </div>

    <footer class="panel-footer flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mt-8">
      <p class="text-xs text-gray-500 max-w-xl">Changes will apply immediately. Save to persist them for future sessions.</p>
      <p-button
        type="button"
        label="Save Settings"
        (onClick)="onSubmit()"
        [disabled]="!settingsForm.dirty"
        styleClass="save-settings-button">
      </p-button>
    </footer>
  </form>
</div>
