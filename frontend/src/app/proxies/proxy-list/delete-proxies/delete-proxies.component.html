<div class="flex items-center">
  <p-button
    type="button"
    label="Delete Proxies"
    icon="pi pi-trash"
    styleClass="p-button-danger"
    (onClick)="openDialog()"
    [disabled]="!hasAnyProxies()"
  ></p-button>
</div>

<p-dialog
  [(visible)]="dialogVisible"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
  [dismissableMask]="true"
  [breakpoints]="{ '960px': '90vw', '640px': '95vw' }"
  [style]="{ width: '50rem' }"
  [contentStyle]="{ padding: '0' }"
  (onHide)="onDialogHide()"
>
  <ng-template pTemplate="header">
    <div class="flex items-center gap-2 text-lg font-semibold text-red-200">
      <span>Delete Proxies</span>
      <app-tooltip [text]="'Delete proxies in bulk with optional filters and status selections. This action cannot be undone.'"></app-tooltip>
    </div>
  </ng-template>

  <div class="bg-neutral-900 text-gray-200 p-6 space-y-6">
    <section class="bg-red-950/40 border border-red-800/60 rounded-xl p-4 text-sm leading-relaxed text-red-200 flex items-start gap-3">
      <i class="pi pi-exclamation-triangle text-base mt-0.5"></i>
      <p>
        Deleted proxies cannot be restored. Use filters to precisely target what you want to remove.
      </p>
    </section>

    <section class="space-y-3">
      <p class="text-sm text-gray-400">Choose which proxies should be considered for deletion.</p>
      <div class="flex flex-col sm:flex-row gap-4">
        <label
          for="deleteAll"
          class="flex-1 bg-neutral-800 border border-neutral-700 rounded-xl px-4 py-3 flex items-start gap-3 cursor-pointer transition-colors theme-card"
          [class.theme-card--active]="deleteOption === 'all'"
        >
          <p-radioButton
            name="deleteOption"
            value="all"
            [(ngModel)]="deleteOption"
            inputId="deleteAll"
          ></p-radioButton>
          <div class="space-y-1">
            <span class="font-semibold text-white">All Proxies</span>
            <p class="text-sm text-gray-400">
              Delete every proxy you own that matches the filters below.
            </p>
          </div>
        </label>

        <label
          for="deleteSelected"
          class="flex-1 bg-neutral-800 border border-neutral-700 rounded-xl px-4 py-3 flex items-start gap-3 cursor-pointer transition-colors theme-card"
          [class.opacity-60]="!canDeleteSelected()"
          [class.cursor-not-allowed]="!canDeleteSelected()"
          [class.theme-card--active]="deleteOption === 'selected'"
          [class.theme-card--disabled]="!canDeleteSelected()"
        >
          <p-radioButton
            name="deleteOption"
            value="selected"
            [(ngModel)]="deleteOption"
            inputId="deleteSelected"
            [disabled]="!canDeleteSelected()"
          ></p-radioButton>
          <div class="space-y-1">
            <span class="font-semibold text-white">Selected Proxies</span>
            <p class="text-sm text-gray-400">Delete only the proxies highlighted in the table on this page.</p>
          </div>
        </label>
      </div>
    </section>

    <form [formGroup]="deleteForm" class="space-y-6">
      <section class="bg-neutral-800 border border-neutral-700 rounded-xl p-5 space-y-5 theme-card">
        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
          <div>
            <h4 class="text-base font-semibold text-white">Filter Before Deleting</h4>
            <p class="text-sm text-gray-400">Toggle to restrict which proxies get removed.</p>
          </div>
          <app-checkbox label="Enable Filters" formControlName="filter"></app-checkbox>
        </div>

        @if (deleteForm.get('filter')?.value) {
          <div class="space-y-6">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div class="flex items-center justify-center">
                <app-checkbox label="HTTP" formControlName="HTTPProtocol"></app-checkbox>
              </div>
              <div class="flex items-center justify-center">
                <app-checkbox label="HTTPS" formControlName="HTTPSProtocol"></app-checkbox>
              </div>
              <div class="flex items-center justify-center">
                <app-checkbox label="SOCKS4" formControlName="SOCKS4Protocol"></app-checkbox>
              </div>
              <div class="flex items-center justify-center">
                <app-checkbox label="SOCKS5" formControlName="SOCKS5Protocol"></app-checkbox>
              </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
              <div>
                <label for="deleteRetries" class="block mb-2 text-sm font-medium text-gray-300">Max Retries</label>
                <p-inputNumber
                  id="deleteRetries"
                  formControlName="Retries"
                  mode="decimal"
                  [showButtons]="true"
                  [min]="0"
                  inputStyleClass="w-full bg-gray-700 text-white border-gray-600 theme-focus"
                ></p-inputNumber>
              </div>
              <div>
                <label for="deleteTimeout" class="block mb-2 text-sm font-medium text-gray-300">Max Timeout (ms)</label>
                <p-inputNumber
                  id="deleteTimeout"
                  formControlName="Timeout"
                  mode="decimal"
                  [showButtons]="true"
                  [min]="0"
                  inputStyleClass="w-full bg-gray-700 text-white border-gray-600 theme-focus"
                ></p-inputNumber>
              </div>
            </div>
          </div>
        } @else {
          <p class="text-sm text-gray-500">
            Enable filters to narrow deletions by protocol or performance thresholds.
          </p>
        }
      </section>

      <section class="bg-neutral-800 border border-neutral-700 rounded-xl p-5 space-y-5 theme-card">
        <div>
          <label for="deleteProxyStatus" class="block mb-2 text-sm font-medium text-gray-300">Proxy Status</label>
          <p-select
            id="deleteProxyStatus"
            formControlName="proxyStatus"
            [options]="proxyStatusOptions"
            optionLabel="label"
            optionValue="value"
            class="w-full"
            panelStyleClass="bg-gray-800 text-white"
            [appendTo]="'body'"
            [scrollHeight]="'200px'"
          ></p-select>
        </div>
      </section>
    </form>
  </div>

  <ng-template pTemplate="footer">
    <div class="w-full flex justify-end gap-3 px-6 pb-4">
      <p-button
        type="button"
        label="Cancel"
        styleClass="p-button-text"
        (onClick)="closeDialog()"
        [disabled]="isDeleting"
      ></p-button>
      <p-button
        type="button"
        label="Delete"
        styleClass="p-button-danger"
        (onClick)="submitDelete()"
        [disabled]="isDeleting || (deleteOption === 'selected' && !canDeleteSelected())"
        [loading]="isDeleting"
      ></p-button>
    </div>
  </ng-template>
</p-dialog>
