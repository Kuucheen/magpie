<div class="proxy-container p-8 min-h-screen text-gray-300">
  <!-- Top Actions -->
  <div class="actions-wrapper">
    <div class="actions mb-4 flex flex-wrap items-center justify-between gap-4">
      <div class="flex flex-wrap items-center gap-4">
        <app-export-proxies
          [allProxies]="dataSource()"
          [selectedProxies]="selectedProxies()"
        ></app-export-proxies>

        <app-delete-proxies
          [allProxies]="dataSource()"
          [selectedProxies]="selectedProxies()"
          (proxiesDeleted)="onProxiesDeleted()"
        ></app-delete-proxies>
      </div>

      <div class="flex flex-wrap items-center gap-4">
        <p-button
          label="Refresh"
          icon="pi pi-refresh"
          styleClass="p-button-outlined"
          [disabled]="isLoading()"
          (onClick)="refreshList()"
        ></p-button>

        <div #filterToggleAnchor>
          <p-button
            [label]="filterButtonLabel()"
            icon="pi pi-filter"
            [styleClass]="filterToggleClass()"
            (onClick)="toggleFilterPanel($event)"
          ></p-button>
        </div>

        <div #columnToggleAnchor>
          <p-button
            label="Columns"
            icon="pi pi-table"
            styleClass="p-button-outlined"
            [disabled]="isSavingColumnPreferences()"
            (onClick)="openColumnPanel($event)"
          ></p-button>
        </div>

        <input
          type="search"
          class="proxy-search-input"
          placeholder="Search proxies"
          [ngModel]="searchTerm()"
          (ngModelChange)="onSearchTermChange($event)"
          aria-label="Search proxies"
        />

        <app-add-proxies
          (showAddProxiesMessage)="showAddProxiesMessage.emit($event)"
          (proxiesAdded)="onProxiesAdded()"
        ></app-add-proxies>
      </div>
    </div>

    @if (filterPanelOpen()) {
      <div #filterPanelRef>
        <app-proxy-filter-panel
          [form]="filterForm"
          [countryOptions]="countryOptions()"
          [typeOptions]="typeOptions()"
          [anonymityOptions]="anonymityOptions()"
          [proxyStatusOptions]="proxyStatusOptions"
          [proxyReputationOptions]="proxyReputationOptions"
          [floating]="true"
          (clear)="clearFilters()"
          (apply)="applyFilters()"
        ></app-proxy-filter-panel>
      </div>
    }

    @if (columnPanelOpen()) {
      <app-column-picker-panel
        #columnPanelRef
        class="column-panel"
        [columns]="proxyTableColumnDefinitions"
        [selectedColumnIds]="displayedColumns()"
        [defaultColumnIds]="defaultProxyTableColumns"
        [saving]="isSavingColumnPreferences()"
        (cancel)="closeColumnPanel()"
        (save)="saveColumnPreferences($event)"
        (dragStarted)="onColumnEditorDragStart()"
        (dragEnded)="onColumnEditorDragEnd()"
      ></app-column-picker-panel>
    }
  </div>

  <app-proxy-table
    [proxies]="dataSource()"
    [loading]="isLoading()"
    [hasLoaded]="hasLoaded()"
    [page]="page()"
    [pageSize]="pageSize()"
    [totalRecords]="totalItems()"
    [rowsPerPageOptions]="rowsPerPageOptions"
    [skeletonRows]="skeletonRows"
    [selectionEnabled]="true"
    [selection]="selectedProxies()"
    [selectionModel]="selection"
    [isAllSelected]="isAllSelected()"
    [sortable]="true"
    [sortField]="sortField()"
    [sortOrder]="sortOrder()"
    [columns]="displayedColumns()"
    (lazyLoad)="onLazyLoad($event)"
    (selectionChange)="onSelectionChange($event)"
    (masterToggle)="masterToggle()"
    (toggleSelection)="toggleSelection($event)"
    (sort)="onSort($event)"
    (viewProxy)="onViewProxy($event)"
  ></app-proxy-table>
</div>
