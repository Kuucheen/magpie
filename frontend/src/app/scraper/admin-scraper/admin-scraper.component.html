<div class="admin-scraper-page text-gray-200">
  <form [formGroup]="settingsForm" class="settings-panel bg-neutral-900 border border-neutral-800 rounded-2xl p-6 shadow-lg">
    <header class="panel-header flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <div>
        <h2 class="text-xl font-semibold text-white mb-1">Admin Scraper Configuration</h2>
        <p class="text-sm text-gray-400 max-w-3xl">
          Control how the scraper revisits sources and balances throughput.
        </p>
      </div>
    </header>

    <div class="panel-body mt-6">
      <p-tabs value="0">
        <p-tablist class="tablist">
          <p-tab value="0">Common</p-tab>
          <p-tab value="1">Sources</p-tab>
        </p-tablist>

        <p-tabpanels>
          <p-tabpanel value="0">
            <div class="tab-stack">
              <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
                <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
                  <div>
                    <h3 class="section-title">Scraper Cadence</h3>
                    <p class="section-hint">Define the interval used to sweep every configured scrape source.</p>
                  </div>
                </div>
                <div class="timer-grid" formGroupName="scraper_timer">
                  <div class="timer-field">
                    <label class="field-label">Days</label>
                    <p-select
                      [options]="daysList"
                      formControlName="days"
                      placeholder="Select Days"
                      optionLabel="label"
                      optionValue="value"
                      class="w-full">
                    </p-select>
                  </div>
                  <div class="timer-field">
                    <label class="field-label">Hours</label>
                    <p-select
                      [options]="hoursList"
                      formControlName="hours"
                      placeholder="Select Hours"
                      optionLabel="label"
                      optionValue="value"
                      class="w-full">
                    </p-select>
                  </div>
                  <div class="timer-field">
                    <label class="field-label">Minutes</label>
                    <p-select
                      [options]="minutesList"
                      formControlName="minutes"
                      placeholder="Select Minutes"
                      optionLabel="label"
                      optionValue="value"
                      class="w-full">
                    </p-select>
                  </div>
                  <div class="timer-field">
                    <label class="field-label">Seconds</label>
                    <p-select
                      [options]="secondsList"
                      formControlName="seconds"
                      placeholder="Select Seconds"
                      optionLabel="label"
                      optionValue="value"
                      class="w-full">
                    </p-select>
                  </div>
                </div>
              </section>

              <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
                <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
                  <div>
                    <h3 class="section-title">Scraper Performance</h3>
                    <p class="section-hint">Balance concurrency and reliability to keep results flowing without excess load.</p>
                  </div>
                </div>
                <div class="field-grid">
                  <div class="field-group">
                    <label class="field-label" for="scraper_threads">
                      Threads
                      <i class="pi pi-info-circle text-gray-400 cursor-help"
                         pTooltip="Determines how many proxies are checked concurrently."
                         tooltipPosition="top">
                      </i>
                    </label>
                    <p-inputNumber
                      formControlName="scraper_threads"
                      [min]="1"
                      [max]="10000"
                      [inputId]="'scraper_threads'"
                      class="w-full">
                    </p-inputNumber>
                  </div>
                  <div class="field-group">
                    <label class="field-label" for="scraper_retries">Retries</label>
                    <p-inputNumber
                      formControlName="scraper_retries"
                      [min]="0"
                      [max]="100"
                      [inputId]="'scraper_retries'"
                      class="w-full">
                    </p-inputNumber>
                  </div>
                  <div class="field-group">
                    <label class="field-label" for="scraper_timeout">Timeout (ms)</label>
                    <p-inputNumber
                      formControlName="scraper_timeout"
                      [min]="1000"
                      [max]="60000"
                      [step]="500"
                      [inputId]="'scraper_timeout'"
                      class="w-full">
                    </p-inputNumber>
                  </div>
                </div>
              </section>

              <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
                <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
                  <div>
                    <h3 class="section-title">Automation Controls</h3>
                    <p class="section-hint">Enable helper features that adapt scraping behaviour to changing load.</p>
                  </div>
                </div>
                <div class="toggle-stack">
                  <div class="toggle-card">
                    <div class="toggle-leading">
                      <p-checkbox
                        formControlName="scraper_dynamic_threads"
                        [binary]="true"
                        inputId="dynamic-threads">
                      </p-checkbox>
                    </div>
                    <label for="dynamic-threads" class="toggle-content">
                      <span class="toggle-title">Dynamic Threads</span>
                      <span class="toggle-hint">Automatically scale thread usage based on available proxies and checker demand.</span>
                    </label>
                  </div>

                  <div class="toggle-card">
                    <div class="toggle-leading">
                      <p-checkbox
                        formControlName="proxy_limit_enabled"
                        [binary]="true"
                        inputId="proxy-limit-enabled">
                      </p-checkbox>
                    </div>
                    <div class="toggle-content">
                      <label for="proxy-limit-enabled" class="toggle-title">Enforce Proxy Limit</label>
                      <span class="toggle-hint">Restrict how many proxies each account can store to prevent hoarding.</span>

                      <div class="proxy-grid mt-4">
                        <div class="field-group">
                          <label class="field-label" for="proxy_limit_max_per_user">Max Proxies Per User</label>
                          <p-inputNumber
                            formControlName="proxy_limit_max_per_user"
                            [min]="0"
                            [max]="1000000"
                            [step]="50"
                            [useGrouping]="false"
                            [inputId]="'proxy_limit_max_per_user'"
                            class="w-full">
                          </p-inputNumber>
                        </div>
                        <div class="toggle-inline">
                          <p-checkbox
                            formControlName="proxy_limit_exclude_admins"
                            [binary]="true"
                            inputId="proxy-limit-exclude-admins">
                          </p-checkbox>
                          <label for="proxy-limit-exclude-admins" class="toggle-inline-label">Exclude admins from limit</label>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </section>
            </div>
          </p-tabpanel>

          <p-tabpanel value="1">
            <div class="tab-stack">
              <section class="section-card bg-neutral-950/40 border border-neutral-800 rounded-xl p-5">
                <div class="section-header flex flex-col gap-2 sm:flex-row sm:items-start sm:justify-between">
                  <div>
                    <h3 class="section-title">Default Scrape Sites</h3>
                    <p class="section-hint">By default, these sources are added to every new account.</p>
                  </div>
                </div>

                <div class="field-group mt-4">
                  <label class="field-label" for="scrape-sites-textarea">Scrape Sites</label>
                  <textarea
                    formControlName="scrape_sites"
                    rows="8"
                    id="scrape-sites-textarea"
                    class="scrape-sites-input"
                    placeholder="Enter one URL per line or separate with commas"></textarea>
                  <small class="hint-text">Empty lines are ignored when saving.</small>
                </div>
              </section>
            </div>
          </p-tabpanel>
        </p-tabpanels>
      </p-tabs>
    </div>

    <footer class="panel-footer mt-6 flex justify-end">
      <p-button
        label="Save Settings"
        icon="pi pi-save"
        (onClick)="onSubmit()"
        [disabled]="!settingsForm.dirty"
        styleClass="save-button">
      </p-button>
    </footer>
  </form>
</div>
