<div class="flex items-center">
  <p-button
    type="button"
    label="Add Sources"
    icon="pi pi-plus"
    (onClick)="openDialog()">
  </p-button>
</div>

<p-dialog
  [(visible)]="dialogVisible"
  [modal]="true"
  [draggable]="false"
  [resizable]="false"
  [dismissableMask]="true"
  [breakpoints]="{ '960px': '90vw', '640px': '95vw' }"
  [style]="{ width: '60rem' }"
  [contentStyle]="{ padding: '0' }"
  [appendTo]="'body'"
  (onHide)="onDialogHide()"
>
  <ng-template pTemplate="header">
    <div class="flex items-center gap-2 text-lg font-semibold">
      <span>Add Scrape Sources</span>
      <i
        class="pi pi-info-circle text-sm text-gray-400 cursor-help"
        pTooltip="A scrape source is a website that displays proxy data. Paste URLs, import a file, or capture from your clipboard."
        tooltipPosition="top"
      ></i>
    </div>
  </ng-template>

  <div class="p-6 bg-neutral-900 text-gray-200">
    <div class="grid grid-cols-1 lg:grid-cols-[1.4fr_1fr] gap-6">
      <div class="space-y-5">
        <div class="flex flex-col gap-4">
          <div class="flex gap-2 w-full">
            <div class="flex-1">
              <p-button
                type="button"
                label="Paste from Clipboard"
                icon="pi pi-clipboard"
                styleClass="w-full"
                (onClick)="pasteFromClipboard()"
                [disabled]="clipboardScrapeSources != ''"
              ></p-button>
            </div>
            @if (clipboardScrapeSources) {
              <p-button
                type="button"
                styleClass="p-button-danger p-button-sm mt-1"
                icon="pi pi-times"
                (onClick)="clearClipboardSources()"
              ></p-button>
            }
          </div>

          <div class="flex gap-2 w-full">
            <div class="flex-1">
              <p-button
                type="button"
                label="Import from File"
                icon="pi pi-upload"
                styleClass="w-full"
                (onClick)="triggerFileInput(fileInput)"
                [disabled]="file != undefined"
              ></p-button>
              <input type="file" #fileInput class="hidden" accept=".txt,.csv" (change)="onFileSelected($event)">
            </div>
            @if (file != undefined) {
              <p-button
                type="button"
                styleClass="p-button-danger p-button-sm mt-1"
                icon="pi pi-times"
                (onClick)="onFileClear()"
              ></p-button>
            }
          </div>
        </div>

        <div>
          <textarea
            maxlength="109999"
            placeholder="Bulk add scrape sources&#10;https://scrape-source.com"
            [(ngModel)]="scrapeSourceTextarea"
            (ngModelChange)="addTextAreaSources()"
            class="w-full h-48 p-3 bg-gray-800 border border-gray-700 rounded-lg text-white placeholder-gray-400 resize-none theme-focus"
          ></textarea>
        </div>
      </div>

      <div class="bg-neutral-800 rounded-xl border border-neutral-700 p-6 flex flex-col items-center justify-center text-gray-200">
        @if (getSourcesCount() > 0) {
          <div class="space-y-3 text-center">
            <div class="text-2xl font-semibold text-white">{{ getSourcesCount() }}</div>
            <div class="text-sm uppercase tracking-wide text-gray-400">Total Sources</div>
            <div class="flex flex-col gap-1">
              <span>Unique: {{ getUniqueSourcesCount() }}</span>
              <span>Clipboard: {{ clipboardSourcesCount }}</span>
              <span>File: {{ fileSourcesCount }}</span>
            </div>
          </div>
        } @else {
          <div class="flex flex-col items-center gap-3 text-gray-500">
            <i class="pi pi-chart-line text-4xl"></i>
            <span class="text-sm">Add sources to see stats here</span>
          </div>
        }
      </div>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <div class="w-full flex justify-end gap-3 px-6 pb-4">
      <p-button type="button" label="Cancel" styleClass="p-button-text" (onClick)="closeDialog()"></p-button>
      <p-button
        type="button"
        label="Add Sources to Queue"
        styleClass="p-button-success"
        (onClick)="submitScrapeSources()"
        [disabled]="!file && !scrapeSourceTextarea && !clipboardScrapeSources"
      ></p-button>
    </div>
  </ng-template>
</p-dialog>

@if (showPopup) {
  <app-procesing-popup
    [status]="popupStatus"
    [count]="addedSourceCount"
    [item]="'scrape sources'"
    (closed)="onPopupClose()"
  ></app-procesing-popup>
}
