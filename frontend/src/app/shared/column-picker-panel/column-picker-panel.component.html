<div class="column-picker">
  <div class="column-picker__header">
    <div class="column-picker__header-copy">
      <h3>Table Columns</h3>
      <p>Choose what is shown. Drag visible items to reorder.</p>
    </div>
    <p-button
      label="Reset"
      icon="pi pi-refresh"
      styleClass="p-button-text p-button-sm"
      (onClick)="resetColumns()"
    ></p-button>
  </div>

  <div class="column-picker__toolbar">
    <input
      type="search"
      class="column-picker__search"
      placeholder="Find columns"
      [ngModel]="search()"
      (ngModelChange)="onSearchChange($event)"
      aria-label="Find columns"
    />
    @if (columnSearchActive()) {
      <span class="column-picker__search-hint">Reordering is disabled while filtering.</span>
    }
  </div>

  <div class="column-picker__content">
    <div class="column-picker__section">
      <div class="column-picker__section-header">
        <div class="column-picker__title">Visible ({{ visibleColumnCount() }})</div>
        <p-button
          label="Hide all"
          icon="pi pi-eye-slash"
          styleClass="p-button-text p-button-sm"
          [disabled]="visibleColumnCount() <= 1"
          (onClick)="hideAllColumns()"
        ></p-button>
      </div>
      <div
        class="column-picker__list"
        cdkDropList
        [cdkDropListData]="visibleColumnsFiltered()"
        (cdkDropListDropped)="onColumnDrop($event)"
      >
        @if (visibleColumnsFiltered().length === 0) {
          <div class="column-picker__empty">No matching visible columns.</div>
        } @else {
          @for (column of visibleColumnsFiltered(); track column.id) {
            <div
              class="column-picker__row"
              cdkDrag
              [cdkDragDisabled]="columnSearchActive()"
              (cdkDragStarted)="onDragStart()"
              (cdkDragEnded)="onDragEnd()"
            >
              <div class="column-picker__row-main">
                <span class="column-picker__drag-handle" cdkDragHandle>
                  <i class="pi pi-bars" aria-hidden="true"></i>
                </span>
                <div class="column-picker__label-wrap">
                  <span class="column-picker__label">{{ column.label }}</span>
                  @if (column.example) {
                    <span class="column-picker__example">{{ column.example }}</span>
                  }
                </div>
              </div>
              <div class="column-picker__controls">
                <p-button
                  icon="pi pi-eye-slash"
                  styleClass="p-button-text p-button-sm"
                  [disabled]="visibleColumnCount() <= 1"
                  (onClick)="hideColumn(column.id)"
                ></p-button>
              </div>
            </div>
          }
        }
      </div>
    </div>

    <div class="column-picker__section">
      <div class="column-picker__section-header">
        <div class="column-picker__title">Hidden ({{ hiddenColumnCount() }})</div>
        <p-button
          label="Show all"
          icon="pi pi-eye"
          styleClass="p-button-text p-button-sm"
          [disabled]="hiddenColumnCount() === 0"
          (onClick)="showAllColumns()"
        ></p-button>
      </div>
      <div class="column-picker__list">
        @if (hiddenColumnsFiltered().length === 0) {
          <div class="column-picker__empty">
            {{ hiddenColumnCount() === 0 ? 'No hidden columns.' : 'No matching hidden columns.' }}
          </div>
        } @else {
          @for (column of hiddenColumnsFiltered(); track column.id) {
            <div class="column-picker__row">
              <div class="column-picker__label-wrap">
                <span class="column-picker__label">{{ column.label }}</span>
                @if (column.example) {
                  <span class="column-picker__example">{{ column.example }}</span>
                }
              </div>
              <p-button
                icon="pi pi-eye"
                styleClass="p-button-text p-button-sm"
                (onClick)="showColumn(column.id)"
              ></p-button>
            </div>
          }
        }
      </div>
    </div>
  </div>

  <div class="column-picker__footer">
    <p-button
      label="Cancel"
      styleClass="p-button-text"
      (onClick)="cancel.emit()"
    ></p-button>
    <p-button
      label="Save"
      icon="pi pi-check"
      [loading]="saving"
      (onClick)="saveChanges()"
    ></p-button>
  </div>
</div>
